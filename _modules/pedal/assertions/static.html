

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pedal.assertions.static &mdash; Pedal 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/argparse.css?v=441cd8df" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Pedal
              <img src="../../../_static/pedal-logo-v3.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../everyone/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../everyone/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../teachers/quickstart.html">Teacher Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../teachers/examples.html">Teacher Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../teachers/reference.html">Teacher Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../teachers/cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../teachers/testing.html">Testing Your Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../teachers/integrations.html">Autograder Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers/ffs.html">Developers: Feedback Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers/api.html">Developer API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers/tools.html">Developer Tools Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers/conventions.html">Internal Naming Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers/libraries.html">Necessary Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers/compilation.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../teachers/analysis.html">Researchers: Analyzing with Pedal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../everyone/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../everyone/contact.html">Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Pedal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../assertions.html">pedal.assertions</a></li>
      <li class="breadcrumb-item active">pedal.assertions.static</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pedal.assertions.static</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Collection of feedback functions related to static checks of student code.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">dataclasses</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">dataclasses</span> <span class="o">=</span> <span class="kc">None</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.assertions.classes</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">missing_dataclass</span><span class="p">,</span> <span class="n">dataclass_not_available</span><span class="p">,</span>
                                      <span class="n">missing_field_type</span><span class="p">,</span> <span class="n">too_few_fields</span><span class="p">,</span> <span class="n">too_many_fields</span><span class="p">,</span>
                                      <span class="n">duplicate_dataclass_definition</span><span class="p">,</span> <span class="n">invalid_field_type</span><span class="p">,</span>
                                      <span class="n">wrong_fields_type</span><span class="p">,</span> <span class="n">name_is_not_a_dataclass</span><span class="p">,</span> <span class="n">missing_dataclass_annotation</span><span class="p">,</span>
                                      <span class="n">unknown_field</span><span class="p">,</span> <span class="n">wrong_field_order</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.assertions.functions</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.cait.cait_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_program</span><span class="p">,</span> <span class="n">find_match</span><span class="p">,</span> <span class="n">find_matches</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.assertions.feedbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssertionFeedback</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.cait.find_node</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_operation</span><span class="p">,</span> <span class="n">find_function_calls</span><span class="p">,</span> <span class="n">find_function_definition</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.core.feedback</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompositeFeedbackFunction</span><span class="p">,</span> <span class="n">Feedback</span><span class="p">,</span> <span class="n">FeedbackResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.core.location</span><span class="w"> </span><span class="kn">import</span> <span class="n">Location</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.core.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">MAIN_REPORT</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.core.commands</span><span class="w"> </span><span class="kn">import</span> <span class="n">compliment</span> <span class="k">as</span> <span class="n">core_compliment</span><span class="p">,</span> <span class="n">give_partial</span><span class="p">,</span> <span class="n">explain</span><span class="p">,</span> <span class="n">gently</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.tifa.commands</span><span class="w"> </span><span class="kn">import</span> <span class="n">tifa_type_check</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.types.normalize</span><span class="w"> </span><span class="kn">import</span> <span class="n">normalize_type</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.types.new_types</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_subtype</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pedal.utilities.ast_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">AST_NODE_NAMES</span>


<span class="k">class</span><span class="w"> </span><span class="nc">EnsureAssertionFeedback</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Abstract base class for assertions preventing things. &quot;&quot;&quot;</span>
    <span class="n">safe_field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;at_least&#39;</span><span class="p">,</span> <span class="s1">&#39;capacity&#39;</span><span class="p">,</span> <span class="s1">&#39;name_message&#39;</span><span class="p">,</span> <span class="s1">&#39;root_message&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">at_least</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">root_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">root</span> <span class="k">else</span> <span class="s2">&quot; (inside of some other code)&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;at_least&#39;</span><span class="p">:</span> <span class="n">at_least</span><span class="p">,</span> <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">,</span> <span class="s1">&#39;name_message&#39;</span><span class="p">:</span> <span class="n">report</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                  <span class="s1">&#39;root_message&#39;</span><span class="p">:</span> <span class="n">root_message</span><span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">uses</span><span class="p">):</span>
        <span class="n">at_least</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;at_least&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">use_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uses</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">at_least</span> <span class="o">&gt;</span> <span class="n">use_count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">at_least</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;capacity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot; at least </span><span class="si">{</span><span class="n">at_least</span><span class="si">}</span><span class="s2"> times, but&quot;</span>
                                           <span class="sa">f</span><span class="s2">&quot; you used it </span><span class="si">{</span><span class="n">use_count</span><span class="si">}</span><span class="s2"> times&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PreventAssertionFeedback</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Abstract base class for assertions preventing things. &quot;&quot;&quot;</span>
    <span class="n">safe_field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;at_most&#39;</span><span class="p">,</span> <span class="s1">&#39;capacity&#39;</span><span class="p">,</span> <span class="s1">&#39;name_message&#39;</span><span class="p">,</span> <span class="s1">&#39;root_message&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">at_most</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">root_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">root</span> <span class="k">else</span> <span class="s2">&quot; (inside of some other code)&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;at_most&#39;</span><span class="p">:</span> <span class="n">at_most</span><span class="p">,</span> <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">,</span> <span class="s1">&#39;name_message&#39;</span><span class="p">:</span> <span class="n">report</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                  <span class="s1">&#39;root_message&#39;</span><span class="p">:</span> <span class="n">root_message</span><span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">uses</span><span class="p">):</span>
        <span class="n">at_most</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;at_most&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">use_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uses</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_count</span> <span class="ow">and</span> <span class="n">at_most</span> <span class="o">&lt;</span> <span class="n">use_count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">at_most</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;capacity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot; more than </span><span class="si">{</span><span class="n">at_most</span><span class="si">}</span><span class="s2"> times, but&quot;</span>
                                           <span class="sa">f</span><span class="s2">&quot; you used it </span><span class="si">{</span><span class="n">use_count</span><span class="si">}</span><span class="s2"> times&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>


<div class="viewcode-block" id="prevent_function_call">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_function_call">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">prevent_function_call</span><span class="p">(</span><span class="n">PreventAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if a function was ever called by statically checking</span>
<span class="sd">    the students&#39; code.</span>

<span class="sd">    # TODO: also check the TIFA records to see if the function was read</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the function (e.g., ``&#39;sum&#39;``)</span>
<span class="sd">        at_most (int): The maximum number of times you are allowed to call this</span>
<span class="sd">            function. Defaults to ``0``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;May Not Use Function&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You used the function </span><span class="si">{name_message}</span><span class="s2"> on line &quot;</span>
                        <span class="s2">&quot;</span><span class="si">{location.line}</span><span class="s2">. You may not use that function&quot;</span>
                        <span class="s2">&quot;</span><span class="si">{capacity}</span><span class="s2">.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="prevent_function_call.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_function_call.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Use find_matches to check number of occurrences. &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">calls</span> <span class="o">=</span> <span class="n">find_function_calls</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">calls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">Location</span><span class="o">.</span><span class="n">from_ast</span><span class="p">(</span><span class="n">calls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;call_count&#39;</span><span class="p">,</span> <span class="n">calls</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ensure_function_call">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_function_call">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ensure_function_call</span><span class="p">(</span><span class="n">EnsureAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine that a function was definitely called by statically checking</span>
<span class="sd">    the students&#39; code.</span>

<span class="sd">    # TODO: Allow parameter to force this to be a method xor/or function call</span>
<span class="sd">    # TODO: Allow set to be passed in for OR, or list for AND, for multiples</span>

<span class="sd">    # TODO: also check the TIFA records to see if the function was read</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the function (e.g., ``&#39;sum&#39;``)</span>
<span class="sd">        at_most (int): The maximum number of times you are allowed to call this</span>
<span class="sd">            function. Defaults to ``0``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Must Use Function&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="s2">&quot;You must use the function </span><span class="si">{name_message}{capacity}</span><span class="s2">.&quot;</span>

<div class="viewcode-block" id="ensure_function_call.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_function_call.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Use find_matches to check number of occurrences. &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">calls</span> <span class="o">=</span> <span class="n">find_function_calls</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;call_count&#39;</span><span class="p">,</span> <span class="n">calls</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="prevent_operation">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_operation">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">prevent_operation</span><span class="p">(</span><span class="n">PreventAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if the given operator `op_name` is not used anywhere.</span>
<span class="sd">    Otherwise, returns `None`. You can specify the</span>
<span class="sd">    operator as a string like `&quot;+&quot;` or `&quot;&lt;&lt;&quot;`. Supports all comparison,</span>
<span class="sd">    boolean, binary, and unary operators.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the function (e.g., ``&#39;sum&#39;``)</span>
<span class="sd">        at_most (int): The maximum number of times you are allowed to call this</span>
<span class="sd">            function. Defaults to ``0``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;May Not Use Operator&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You used the operator </span><span class="si">{name_message}</span><span class="s2"> on line &quot;</span>
                        <span class="s2">&quot;</span><span class="si">{location.line}</span><span class="s2">. You may not use that operator&quot;</span>
                        <span class="s2">&quot;</span><span class="si">{capacity}</span><span class="s2">.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="prevent_operation.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_operation.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Use find_matches to check number of occurrences. &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name_message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">python_expression</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">uses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_operation</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">uses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">Location</span><span class="o">.</span><span class="n">from_ast</span><span class="p">(</span><span class="n">uses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;use_count&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ensure_operation">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_operation">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ensure_operation</span><span class="p">(</span><span class="n">EnsureAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if the given operator `op_name` is used somewhere. You can</span>
<span class="sd">    specify the operator as a string like `&quot;+&quot;` or `&quot;&lt;&lt;&quot;`. Supports all</span>
<span class="sd">    comparison, boolean, binary, and unary operators.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the function (e.g., ``&#39;sum&#39;``)</span>
<span class="sd">        at_least (int): The minimum number of times you must call this</span>
<span class="sd">            function. Defaults to ``1``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Must Use Operator&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="s2">&quot;You must use the operator </span><span class="si">{name_message}{capacity}</span><span class="s2">.&quot;</span>

<div class="viewcode-block" id="ensure_operation.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_operation.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Use find_matches to check number of occurrences. &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name_message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">python_expression</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">uses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">find_operation</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">uses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">Location</span><span class="o">.</span><span class="n">from_ast</span><span class="p">(</span><span class="n">uses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;use_count&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span></div>
</div>



<span class="n">ensure_operator</span> <span class="o">=</span> <span class="n">ensure_operation</span>
<span class="n">prevent_operator</span> <span class="o">=</span> <span class="n">prevent_operation</span>


<div class="viewcode-block" id="prevent_literal">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_literal">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">prevent_literal</span><span class="p">(</span><span class="n">PreventAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Make sure that the given literal value does not appear in the student&#39;s</span>
<span class="sd">    code. &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;May Not Use Literal Value&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You used the literal value {literal_message:python_expression} on line &quot;</span>
                        <span class="s2">&quot;</span><span class="si">{location.line}</span><span class="s2">. You may not use that value&quot;</span>
                        <span class="s2">&quot;</span><span class="si">{capacity}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">safe_field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;literal&#39;</span><span class="p">,</span> <span class="s1">&#39;at_most&#39;</span><span class="p">,</span> <span class="s1">&#39;capacity&#39;</span><span class="p">,</span> <span class="s1">&#39;literal_message&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">literal</span><span class="p">,</span> <span class="n">at_most</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;literal&#39;</span><span class="p">:</span> <span class="n">literal</span><span class="p">,</span> <span class="s1">&#39;at_most&#39;</span><span class="p">:</span> <span class="n">at_most</span><span class="p">,</span> <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">,</span> <span class="s1">&#39;literal_message&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">literal</span><span class="p">)}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="prevent_literal.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_literal.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">literal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;literal&#39;</span><span class="p">]</span>
        <span class="n">uses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_matches</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">literal</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">uses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">uses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">match_location</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;use_count&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span></div>
</div>



<span class="c1"># TODO: ensure_literal does not recognize None?</span>
<div class="viewcode-block" id="ensure_literal">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_literal">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ensure_literal</span><span class="p">(</span><span class="n">EnsureAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Make sure that the given literal value does appear in the student&#39;s</span>
<span class="sd">        code. &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Must Use Literal Value&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="s2">&quot;You must use the literal value </span><span class="si">{literal_message}{capacity}</span><span class="s2">.&quot;</span>
    <span class="n">safe_field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;literal&#39;</span><span class="p">,</span> <span class="s1">&#39;at_least&#39;</span><span class="p">,</span> <span class="s1">&#39;capacity&#39;</span><span class="p">,</span> <span class="s1">&#39;literal_message&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">literal</span><span class="p">,</span> <span class="n">at_least</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;literal&#39;</span><span class="p">:</span> <span class="n">literal</span><span class="p">,</span> <span class="s1">&#39;at_least&#39;</span><span class="p">:</span> <span class="n">at_least</span><span class="p">,</span> <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">,</span> <span class="s1">&#39;literal_message&#39;</span><span class="p">:</span> <span class="n">report</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">python_expression</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">literal</span><span class="p">))}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="ensure_literal.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_literal.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">literal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;literal&#39;</span><span class="p">]</span>
        <span class="n">uses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_matches</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">literal</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">uses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">uses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">match_location</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;use_count&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="prevent_literal_type">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_literal_type">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">prevent_literal_type</span><span class="p">(</span><span class="n">PreventAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Make sure that the given literal value does not appear in the student&#39;s</span>
<span class="sd">    code. &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;May Not Use Type of Literal Value&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You used the literal value type &quot;</span>
                        <span class="s2">&quot;{literal_type_message:python_expression} on line </span><span class="si">{location.line}</span><span class="s2">.&quot;</span>
                        <span class="s2">&quot; You may not use that type of value</span><span class="si">{capacity}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">safe_field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;literal_type&#39;</span><span class="p">,</span> <span class="s1">&#39;at_most&#39;</span><span class="p">,</span> <span class="s1">&#39;capacity&#39;</span><span class="p">,</span> <span class="s1">&#39;literal_type_message&#39;</span><span class="p">]</span>
    <span class="n">safe_field_converters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;literal_type&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">literal_type</span><span class="p">,</span> <span class="n">at_most</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;literal_type&#39;</span><span class="p">:</span> <span class="n">literal_type</span><span class="p">,</span> <span class="s1">&#39;at_most&#39;</span><span class="p">:</span> <span class="n">at_most</span><span class="p">,</span>
                  <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">,</span>
                  <span class="s1">&#39;literal_type_message&#39;</span><span class="p">:</span> <span class="n">literal_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="prevent_literal_type.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_literal_type.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">literal_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;literal_type&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">literal_type</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_matches</span><span class="p">(</span><span class="s2">&quot;False&quot;</span><span class="p">)</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_matches</span><span class="p">(</span><span class="s2">&quot;True&quot;</span><span class="p">))</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">match_root</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">uses</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">literal_type</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;Str&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">literal_type</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;Num&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">literal_type</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">literal_type</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;List&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">literal_type</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;Dict&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown literal type: </span><span class="si">{</span><span class="n">literal_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">uses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;use_count&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ensure_literal_type">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_literal_type">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ensure_literal_type</span><span class="p">(</span><span class="n">EnsureAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Make sure that the given type of literal value does appear in the</span>
<span class="sd">    student&#39;s code. &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Must Use Type of Literal Value&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="s2">&quot;You must use a literal value of type {literal_type_message:python_expression}</span><span class="si">{capacity}</span><span class="s2">.&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">literal_type</span><span class="p">,</span> <span class="n">at_least</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;literal_type&#39;</span><span class="p">:</span> <span class="n">literal_type</span><span class="p">,</span> <span class="s1">&#39;at_least&#39;</span><span class="p">:</span> <span class="n">at_least</span><span class="p">,</span>
                  <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">,</span>
                  <span class="s1">&#39;literal_type_message&#39;</span><span class="p">:</span> <span class="n">literal_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="ensure_literal_type.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_literal_type.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">literal_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;literal_type&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">literal_type</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_matches</span><span class="p">(</span><span class="s2">&quot;False&quot;</span><span class="p">)</span><span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_matches</span><span class="p">(</span><span class="s2">&quot;True&quot;</span><span class="p">))</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">match_root</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">uses</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">literal_type</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;Str&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">literal_type</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;Num&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">literal_type</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">literal_type</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;List&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">literal_type</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">uses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;Dict&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown literal type: </span><span class="si">{</span><span class="n">literal_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">uses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;use_count&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="prevent_ast">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_ast">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">prevent_ast</span><span class="p">(</span><span class="n">PreventAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if the given ast `name` is not used anywhere, returning</span>
<span class="sd">    the node of it if it is. You can refer to Green Tree Snakes documentation</span>
<span class="sd">    for more information about AST Names:</span>

<span class="sd">        https://greentreesnakes.readthedocs.io/en/latest/nodes.html</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the function (e.g., ``&#39;sum&#39;``)</span>
<span class="sd">        at_most (int): The maximum number of times you are allowed to use this</span>
<span class="sd">            AST. Defaults to ``0``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;May Not Use Code&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You used </span><span class="si">{name_message}</span><span class="s2"> on line &quot;</span>
                        <span class="s2">&quot;</span><span class="si">{location.line}</span><span class="s2">. You may not use that&quot;</span>
                        <span class="s2">&quot;</span><span class="si">{capacity}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">justification_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Incorrectly found a </span><span class="si">{name_message}{capacity}{root_message}</span><span class="s2">.&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Correctly found a </span><span class="si">{name_message}{capacity}{root_message}</span><span class="s2">.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="prevent_ast.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_ast.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Use find_all to check number of occurrences. &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name_message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AST_NODE_NAMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">uses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">uses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">Location</span><span class="o">.</span><span class="n">from_ast</span><span class="p">(</span><span class="n">uses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;use_count&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ensure_ast">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_ast">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ensure_ast</span><span class="p">(</span><span class="n">EnsureAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if the given ast `name` is used anywhere, returning</span>
<span class="sd">    the node of it if it is. You can refer to Green Tree Snakes documentation</span>
<span class="sd">    for more information about AST Names:</span>

<span class="sd">        https://greentreesnakes.readthedocs.io/en/latest/nodes.html</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the node.</span>
<span class="sd">        at_least (int): The minimum number of times you must use this</span>
<span class="sd">            node. Defaults to ``1``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Must Use Code&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="s2">&quot;You must use </span><span class="si">{name_message}{capacity}</span><span class="s2">.&quot;</span>
    <span class="n">justification_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Failed to find a </span><span class="si">{name_message}{capacity}{root_message}</span><span class="s2">.&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Successfully found a </span><span class="si">{name_message}{capacity}{root_message}</span><span class="s2">.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ensure_ast.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_ast.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Use find_all to check number of occurrences. &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name_message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AST_NODE_NAMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">uses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">uses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">Location</span><span class="o">.</span><span class="n">from_ast</span><span class="p">(</span><span class="n">uses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_usage</span><span class="p">(</span><span class="s1">&#39;use_count&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="function_prints">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.function_prints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">function_prints</span><span class="p">(</span><span class="n">function_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine that the print function is called within this function, by</span>
<span class="sd">    tracing its code statically. Does not actually verify that the function</span>
<span class="sd">    was ever called in practice.</span>

<span class="sd">    Args:</span>
<span class="sd">        function_name (str): The name of the function to search.</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ensure_function_call</span><span class="p">(</span><span class="s1">&#39;print&#39;</span><span class="p">,</span>
                                <span class="n">root</span><span class="o">=</span><span class="n">find_function_definition</span><span class="p">(</span><span class="n">function_name</span><span class="p">))</span></div>



<div class="viewcode-block" id="has_import">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.has_import">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">has_import</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if the given module name is in the code.</span>

<span class="sd">    Args:</span>
<span class="sd">        ast (:py:class:`pedal.cait.cait_node.CaitNode`): The starting point</span>
<span class="sd">            to search.</span>
<span class="sd">        name (str): The name of the module to match against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Whether or not the module name was matched.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">imports</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;Import&quot;</span><span class="p">)</span>
    <span class="n">import_froms</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;ImportFrom&quot;</span><span class="p">)</span>
    <span class="c1"># What about ``import &lt;name&gt;``</span>
    <span class="k">if</span> <span class="n">imports</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">imports</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># What about ``from &lt;name&gt; import *``</span>
    <span class="k">if</span> <span class="n">import_froms</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">module</span> <span class="o">==</span> <span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">import_froms</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="ensure_import">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_import">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ensure_import</span><span class="p">(</span><span class="n">EnsureAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify that the given ``module`` has been imported, by statically</span>
<span class="sd">    checking the import statements in the code. The ``at_least`` parameter</span>
<span class="sd">    is ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Must Import Module&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="s2">&quot;You must import the module </span><span class="si">{name_message}</span><span class="s2">.&quot;</span>

<div class="viewcode-block" id="ensure_import.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_import.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Traverse the AST to find matches. &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">has_import</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="prevent_import">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_import">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">prevent_import</span><span class="p">(</span><span class="n">PreventAssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify that the given ``module`` has not been imported, by statically</span>
<span class="sd">    checking the import statements in the code. The ``at_most`` parameter</span>
<span class="sd">    is ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;May Not Import Module&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="s2">&quot;You may not import the module </span><span class="si">{name_message}</span><span class="s2">.&quot;</span>

<div class="viewcode-block" id="prevent_import.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_import.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Traverse the AST to find matches. &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">has_import</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ensure_documented_functions">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_documented_functions">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ensure_documented_functions</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Checks that all of the functions in the source code are documented. &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Must Document Functions&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You must document the following function</span><span class="si">{plural}</span><span class="s2">:&quot;</span>
                        <span class="s2">&quot; </span><span class="si">{names_message}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="ensure_documented_functions.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_documented_functions.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Traverse the AST to find matches. &quot;&quot;&quot;</span>
        <span class="n">defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;FunctionDef&#39;</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a_def</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">:</span>
            <span class="c1"># Don&#39;t have to document constructors (happens in Class Def)</span>
            <span class="k">if</span> <span class="n">a_def</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__init__&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a_def</span><span class="o">.</span><span class="n">body</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a_def</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ast_name</span> <span class="o">!=</span> <span class="s2">&quot;Expr&quot;</span> <span class="ow">or</span>
                                <span class="n">a_def</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">ast_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Str&quot;</span><span class="p">,</span> <span class="s2">&quot;Constant&quot;</span><span class="p">))):</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_def</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;names_message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                                                 <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;plural&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span> <span class="k">if</span> <span class="n">names</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">names</span><span class="p">)</span></div>
</div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">New assertions:</span>

<span class="sd">prevent_literal(literal_value: Any)</span>
<span class="sd">prevent_function_call(function_name: str) # Whether it was detected statically</span>
<span class="sd">prevent_operation(operator: str)</span>
<span class="sd">prevent_import(module_name: str)</span>
<span class="sd">prevent_ast(ast_name: str)</span>

<span class="sd">TODO: prevent_source_text(code: str, missing=False, minimum=2, maximum=3)</span>
<span class="sd">TODO: prevent_traced_call(function_name: str)# Whether it was detected dynamically</span>
<span class="sd">TODO: prevent_name(variable_name: str)</span>
<span class="sd">TODO: prevent_assignment(variable_name: str, type: str, value: Any)</span>
<span class="sd">TODO: ensure_function</span>

<span class="sd">ensure_prints(count)</span>
<span class="sd">    ensure_function_call(&#39;print&#39;, at_least=count)</span>
<span class="sd">    ensure_function_call(&#39;print&#39;, at_most=count)</span>
<span class="sd">function_prints =&gt; ensure_function_call(&#39;print&#39;, root=match_signature(&#39;name&#39;)</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># TODO: wait, is this a positive feedback group waiting to happen?</span>

<div class="viewcode-block" id="ensure_function">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_function">[docs]</a>
<span class="nd">@CompositeFeedbackFunction</span><span class="p">(</span><span class="n">missing_function</span><span class="p">,</span> <span class="n">duplicate_function_definition</span><span class="p">,</span>
                           <span class="n">too_few_parameters</span><span class="p">,</span> <span class="n">too_many_parameters</span><span class="p">,</span>
                           <span class="n">missing_parameter_type</span><span class="p">,</span> <span class="n">invalid_parameter_type</span><span class="p">,</span>
                           <span class="n">wrong_parameter_type</span><span class="p">,</span> <span class="n">wrong_return_type</span><span class="p">,</span>
                           <span class="n">missing_return_type</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ensure_function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">returns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compliment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Checks that the function exists and has the right signature. &quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
    <span class="n">defs</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;FunctionDef&#39;</span><span class="p">)</span>
    <span class="n">defs</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_def</span> <span class="k">for</span> <span class="n">a_def</span> <span class="ow">in</span> <span class="n">defs</span> <span class="k">if</span> <span class="n">a_def</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">defs</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">missing_function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">Location</span><span class="o">.</span><span class="n">from_ast</span><span class="p">(</span><span class="n">a_def</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_def</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">duplicate_function_definition</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">defs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Actual logic</span>
    <span class="c1"># 1.2.1 &#39;arity&#39; style - simply checks number of parameters</span>
    <span class="k">if</span> <span class="n">arity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">expected_arity</span> <span class="o">=</span> <span class="n">arity</span> <span class="k">if</span> <span class="n">arity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">actual_arity</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">actual_arity</span> <span class="o">&lt;</span> <span class="n">expected_arity</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">too_few_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_arity</span><span class="p">,</span> <span class="n">expected_arity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">actual_arity</span> <span class="o">&gt;</span> <span class="n">expected_arity</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">too_many_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_arity</span><span class="p">,</span> <span class="n">expected_arity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># 1.2.2 &#39;parameters&#39; style - checks each parameter&#39;s name and type</span>
    <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">actual_parameters</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span>
        <span class="k">for</span> <span class="n">expected_parameter</span><span class="p">,</span> <span class="n">actual_parameter</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">actual_parameters</span><span class="p">):</span>
            <span class="n">expected_parameter_type</span> <span class="o">=</span> <span class="n">normalize_type</span><span class="p">(</span><span class="n">expected_parameter</span><span class="p">,</span> <span class="n">tifa_type_check</span><span class="p">)</span><span class="o">.</span><span class="n">as_type</span><span class="p">()</span>
            <span class="n">actual_parameter_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">actual_parameter</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">actual_parameter</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                     <span class="k">else</span> <span class="n">actual_parameter</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">actual_parameter</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">missing_parameter_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_parameter_name</span><span class="p">,</span>
                                              <span class="n">expected_parameter_type</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">actual_parameter_type</span> <span class="o">=</span> <span class="n">normalize_type</span><span class="p">(</span><span class="n">actual_parameter</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">ast_node</span><span class="p">,</span>
                                                       <span class="n">tifa_type_check</span><span class="p">)</span><span class="o">.</span><span class="n">as_type</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">invalid_parameter_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_parameter_name</span><span class="p">,</span>
                                              <span class="n">actual_parameter</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span>
                                              <span class="n">expected_parameter_type</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_subtype</span><span class="p">(</span><span class="n">actual_parameter_type</span><span class="p">,</span> <span class="n">expected_parameter_type</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">wrong_parameter_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_parameter_name</span><span class="p">,</span>
                                            <span class="n">actual_parameter_type</span><span class="p">,</span>
                                            <span class="n">expected_parameter_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># 1.2.3. &#39;returns&#39; style - checks the return type explicitly</span>
    <span class="k">if</span> <span class="n">returns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">expected_returns</span> <span class="o">=</span> <span class="n">normalize_type</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">tifa_type_check</span><span class="p">)</span><span class="o">.</span><span class="n">as_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">definition</span><span class="o">.</span><span class="n">returns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">missing_return_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expected_returns</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">actual_returns</span> <span class="o">=</span> <span class="n">normalize_type</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">returns</span><span class="o">.</span><span class="n">ast_node</span><span class="p">,</span>
                                            <span class="n">tifa_type_check</span><span class="p">)</span><span class="o">.</span><span class="n">as_type</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">invalid_return_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">definition</span><span class="o">.</span><span class="n">returns</span><span class="p">,</span>
                                       <span class="n">expected_returns</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_subtype</span><span class="p">(</span><span class="n">actual_returns</span><span class="p">,</span> <span class="n">expected_returns</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">wrong_return_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_returns</span><span class="p">,</span> <span class="n">expected_returns</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Alternatively, returns positive FF?</span>
    <span class="k">if</span> <span class="n">compliment</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compliment</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">core_compliment</span><span class="p">(</span><span class="n">compliment</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;function_defined&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">compliment</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">core_compliment</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Defined </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;function_defined&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">):</span>
        <span class="n">give_partial</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;function_defined&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="ensure_dataclass">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_dataclass">[docs]</a>
<span class="nd">@CompositeFeedbackFunction</span><span class="p">(</span><span class="n">missing_dataclass</span><span class="p">,</span> <span class="n">duplicate_dataclass_definition</span><span class="p">,</span>
                           <span class="n">too_few_fields</span><span class="p">,</span> <span class="n">too_many_fields</span><span class="p">,</span> <span class="n">invalid_field_type</span><span class="p">,</span>
                           <span class="n">unknown_field</span><span class="p">,</span>
                           <span class="n">missing_field_type</span><span class="p">,</span> <span class="n">wrong_fields_type</span><span class="p">,</span> <span class="n">name_is_not_a_dataclass</span><span class="p">,</span>
                           <span class="n">dataclass_not_available</span><span class="p">,</span> <span class="n">missing_dataclass_annotation</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ensure_dataclass</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compliment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures that the actual definition for the given class exists.</span>
<span class="sd">    You can provide either a string and fields, or an instructor-defined version</span>

<span class="sd">    Arguments:</span>
<span class="sd">        name (str or dataclass): Either the name of the expected dataclass, or a</span>
<span class="sd">            dataclass object (not an instance).</span>
<span class="sd">        fields (dict): A dictionary of field names to types.</span>
<span class="sd">        root (CaitNode): The AST to search through; defaults to program root.</span>
<span class="sd">        compliment (str or bool): If True, will use the compliment function to</span>
<span class="sd">            provide positive feedback. If a string, will use that string as the</span>
<span class="sd">            compliment. If False, will not provide positive feedback.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Fields will be a dictionary or class</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Or assume it is a dataclass provided by the instructor</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">name</span><span class="p">)}</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="c1"># Inspect the code for the definition</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
    <span class="n">defs</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;ClassDef&#39;</span><span class="p">)</span>
    <span class="n">defs</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_def</span> <span class="k">for</span> <span class="n">a_def</span> <span class="ow">in</span> <span class="n">defs</span> <span class="k">if</span> <span class="n">a_def</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">defs</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">missing_dataclass</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">Location</span><span class="o">.</span><span class="n">from_ast</span><span class="p">(</span><span class="n">a_def</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_def</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">duplicate_dataclass_definition</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">defs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">definition_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">body</span>
                         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">ast_node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">simple</span><span class="p">]</span>
    <span class="c1"># TODO: Support ast.Assign nodes for default values</span>
    <span class="c1"># 1. Make sure import is present</span>
    <span class="n">missing_import</span> <span class="o">=</span> <span class="n">ensure_import</span><span class="p">(</span><span class="s1">&#39;dataclasses&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">missing_import</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">missing_import</span>
    <span class="k">for</span> <span class="n">decorator</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">:</span>
        <span class="c1"># TODO: Support the @dataclasses.dataclass style too</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decorator</span><span class="o">.</span><span class="n">ast_node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">decorator</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s1">&#39;dataclass&#39;</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">missing_dataclass_annotation</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># 2. Confirm the number of fields</span>
    <span class="n">expected_arity</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
    <span class="n">actual_arity</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">definition_fields</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">actual_arity</span> <span class="o">&lt;</span> <span class="n">expected_arity</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">too_few_fields</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_arity</span><span class="p">,</span> <span class="n">expected_arity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">actual_arity</span> <span class="o">&gt;</span> <span class="n">expected_arity</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">too_many_fields</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_arity</span><span class="p">,</span> <span class="n">expected_arity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># 3. checks each field&#39;s name and type</span>
    <span class="k">for</span> <span class="n">actual_field</span> <span class="ow">in</span> <span class="n">definition_fields</span><span class="p">:</span>
        <span class="n">actual_field_name</span> <span class="o">=</span> <span class="n">actual_field</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="n">actual_field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unknown_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_field_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">expected_field</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">actual_field_name</span><span class="p">]</span>
        <span class="n">expected_field_type</span> <span class="o">=</span> <span class="n">normalize_type</span><span class="p">(</span><span class="n">expected_field</span><span class="p">,</span> <span class="n">tifa_type_check</span><span class="p">)</span><span class="o">.</span><span class="n">as_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">actual_field</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">missing_field_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_field_name</span><span class="p">,</span> <span class="n">expected_field_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">actual_field_type</span> <span class="o">=</span> <span class="n">normalize_type</span><span class="p">(</span><span class="n">actual_field</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">ast_node</span><span class="p">,</span>
                                               <span class="n">tifa_type_check</span><span class="p">)</span><span class="o">.</span><span class="n">as_type</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">invalid_field_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_field_name</span><span class="p">,</span> <span class="n">actual_field</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span>
                                      <span class="n">expected_field_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_subtype</span><span class="p">(</span><span class="n">actual_field_type</span><span class="p">,</span> <span class="n">expected_field_type</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">wrong_fields_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_field_name</span><span class="p">,</span> <span class="n">actual_field_type</span><span class="p">,</span>
                                     <span class="n">expected_field_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">actual_field</span><span class="p">,</span> <span class="n">expected_field</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">definition_fields</span><span class="p">,</span> <span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">actual_field_name</span> <span class="o">=</span> <span class="n">actual_field</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="n">actual_field_name</span> <span class="o">!=</span> <span class="n">expected_field</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrong_field_order</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_field_name</span><span class="p">,</span> <span class="n">expected_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Alternatively, returns positive FF?</span>
    <span class="k">if</span> <span class="n">compliment</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compliment</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">core_compliment</span><span class="p">(</span><span class="n">compliment</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dataclass_defined&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">compliment</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">core_compliment</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Defined </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dataclass_defined&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">):</span>
        <span class="n">give_partial</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dataclass_defined&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ensure_prints_exactly">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_prints_exactly">[docs]</a>
<span class="nd">@CompositeFeedbackFunction</span><span class="p">(</span><span class="n">prevent_function_call</span><span class="p">,</span> <span class="n">ensure_function_call</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ensure_prints_exactly</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DEPRECATED.</span>

<span class="sd">    Used to ensure that the student&#39;s code calls the print function a certain</span>
<span class="sd">    number of times.</span>

<span class="sd">    Args:</span>
<span class="sd">        count (int): The minimum and maximum number of times you can call print.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Whether or not both the maximum and minimum was met.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ensure_function_call</span><span class="p">(</span><span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="n">at_least</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">prevent_function_call</span><span class="p">(</span><span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="n">at_most</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>



<div class="viewcode-block" id="ensure_starting_code">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_starting_code">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ensure_starting_code</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detects if the given code is missing.&quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Don&#39;t Change Starting Code&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="s2">&quot;You have changed or removed the starting code. &quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="ensure_starting_code.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_starting_code.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Traverse the AST to find matches. &quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">ast</span><span class="o">.</span><span class="n">find_match</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="prevent_embedded_answer">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_embedded_answer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">prevent_embedded_answer</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Detects if the given code is present. &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Don&#39;t Write Answer Directly&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You have embedded the answer directly in your code, &quot;</span>
                        <span class="s2">&quot;instead of writing code to compute the answer.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="prevent_embedded_answer.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_embedded_answer.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Traverse the AST to find matches. &quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">find_match</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="prevent_printing_functions">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_printing_functions">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">prevent_printing_functions</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detects if the user has defined a function with a print statement inside.</span>

<span class="sd">    Args:</span>
<span class="sd">        exceptions: A set of function names (or a single string) of functions to allow to print (e.g., `&#39;main&#39;`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Do Not Print in Function&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The function </span><span class="si">{name}</span><span class="s2"> is printing on line {location.line:line}.&quot;</span>
                        <span class="s2">&quot; However, that function is not supposed to print.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exceptions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">,</span> <span class="s1">&#39;exceptions&#39;</span><span class="p">:</span> <span class="n">exceptions</span><span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="prevent_printing_functions.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_printing_functions.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">exceptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;exceptions&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exceptions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exceptions</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">{</span><span class="n">exceptions</span><span class="p">}</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
        <span class="n">defs</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;FunctionDef&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a_def</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">a_def</span><span class="o">.</span><span class="n">_name</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">find_function_calls</span><span class="p">(</span><span class="s2">&quot;print&quot;</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">a_def</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">):</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">locate</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>
</div>



<div class="viewcode-block" id="ensure_functions_return">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_functions_return">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ensure_functions_return</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detects if the user has defined a function with a print statement inside.</span>

<span class="sd">    Args:</span>
<span class="sd">        exceptions: A set of function names (or a single string) of functions to allow to print (e.g., `&#39;main&#39;`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Must Return in Function&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The function </span><span class="si">{name}</span><span class="s2"> is not returning.&quot;</span>
                        <span class="s2">&quot; However, that function is supposed to have a return statement.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exceptions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">,</span> <span class="s1">&#39;exceptions&#39;</span><span class="p">:</span> <span class="n">exceptions</span><span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="ensure_functions_return.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.ensure_functions_return.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">exceptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;exceptions&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exceptions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exceptions</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">{</span><span class="n">exceptions</span><span class="p">}</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
        <span class="n">defs</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;FunctionDef&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a_def</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">a_def</span><span class="o">.</span><span class="n">_name</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a_def</span><span class="o">.</span><span class="n">find_match</span><span class="p">(</span><span class="s2">&quot;return&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>
</div>



<div class="viewcode-block" id="only_printing_variables">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.only_printing_variables">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">only_printing_variables</span><span class="p">(</span><span class="n">AssertionFeedback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines whether the user is only printing variables, as opposed to</span>
<span class="sd">    literal values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Print Variables, Not Values&quot;</span>
    <span class="n">message_template</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;You printed something other than a variable on&quot;</span>
                      <span class="s2">&quot; line {location.line:line}. Although that is not a&quot;</span>
                      <span class="s2">&quot; normally an issue, we want you to practice printing&quot;</span>
                      <span class="s2">&quot; variables in this problem.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;fields&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="n">MAIN_REPORT</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="n">parse_program</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="only_printing_variables.condition">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.only_printing_variables.condition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Uses find_all to detect matches, ignoring named values. &quot;&quot;&quot;</span>
        <span class="n">print_calls</span> <span class="o">=</span> <span class="n">find_function_calls</span><span class="p">(</span><span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">],</span>
                                          <span class="n">report</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">print_call</span> <span class="ow">in</span> <span class="n">print_calls</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">print_call</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">ast_name</span> <span class="o">!=</span> <span class="s2">&quot;Name&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">print_call</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_location</span><span class="p">(</span><span class="n">print_call</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>
</div>



<span class="n">ADVANCED_ITERATION_FUNCTIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="s2">&quot;filter&quot;</span><span class="p">,</span> <span class="s2">&quot;reduce&quot;</span><span class="p">,</span>
    <span class="s2">&quot;len&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sorted&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
    <span class="s2">&quot;getattr&quot;</span><span class="p">,</span> <span class="s2">&quot;setattr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eval&quot;</span><span class="p">,</span> <span class="s2">&quot;exec&quot;</span><span class="p">,</span> <span class="s2">&quot;iter&quot;</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span>
<span class="p">]</span>


<div class="viewcode-block" id="prevent_advanced_iteration">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.prevent_advanced_iteration">[docs]</a>
<span class="nd">@CompositeFeedbackFunction</span><span class="p">(</span><span class="n">prevent_ast</span><span class="p">,</span> <span class="n">prevent_function_call</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prevent_advanced_iteration</span><span class="p">(</span><span class="n">allow_while</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_for</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">allow_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Prevents the student from using certain advanced iteration functions</span>
<span class="sd">    and constructs. Does not currently support blocking recursion. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">allow_function</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">allow_function</span> <span class="o">=</span> <span class="p">{</span><span class="n">allow_function</span><span class="p">}</span>
    <span class="k">elif</span> <span class="n">allow_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">allow_function</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_while</span><span class="p">:</span>
        <span class="n">prevent_ast</span><span class="p">(</span><span class="s2">&quot;While&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_for</span><span class="p">:</span>
        <span class="n">prevent_ast</span><span class="p">(</span><span class="s2">&quot;For&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="n">ADVANCED_ITERATION_FUNCTIONS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">function_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_function</span><span class="p">:</span>
            <span class="n">prevent_function_call</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="open_without_arguments">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.open_without_arguments">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">open_without_arguments</span><span class="p">(</span><span class="n">FeedbackResponse</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detects if the user has called the `open` function without any arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">muted</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Opened Without Arguments&quot;</span>
    <span class="n">message_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You have called the `open` function &quot;</span>
                        <span class="s2">&quot;without any arguments. It needs a filename.&quot;</span><span class="p">)</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">Feedback</span><span class="o">.</span><span class="n">CATEGORIES</span><span class="o">.</span><span class="n">INSTRUCTOR</span></div>



<div class="viewcode-block" id="files_not_handled_correctly">
<a class="viewcode-back" href="../../../developers/tools/assertions.html#pedal.assertions.static.files_not_handled_correctly">[docs]</a>
<span class="nd">@CompositeFeedbackFunction</span><span class="p">(</span><span class="n">open_without_arguments</span><span class="p">,</span> <span class="n">ensure_literal</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">files_not_handled_correctly</span><span class="p">(</span><span class="o">*</span><span class="n">filenames</span><span class="p">,</span> <span class="n">muted</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Statically detect if files have been opened and closed correctly.</span>
<span class="sd">    This is only useful in the case of very simplistic file handling.</span>

<span class="sd">    TODO: This could be vastly improved with line numbers and other information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filenames</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">num_filenames</span> <span class="o">=</span> <span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">actual_filenames</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_filenames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
        <span class="n">actual_filenames</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">parse_program</span><span class="p">()</span>
    <span class="n">calls</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;Call&quot;</span><span class="p">)</span>
    <span class="n">called_open</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">closed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a_call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a_call</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">ast_name</span> <span class="o">==</span> <span class="s1">&#39;Name&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a_call</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s1">&#39;open&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">a_call</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                    <span class="n">open_without_arguments</span><span class="p">(</span><span class="n">muted</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="n">called_open</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_call</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">a_call</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span>
                <span class="n">explain</span><span class="p">(</span><span class="s2">&quot;You have attempted to call `close` as a &quot;</span>
                        <span class="s2">&quot;function, but it is actually a method of the &quot;</span>
                        <span class="s2">&quot;file object.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;used_close_as_function&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Close Is a Method&quot;</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="s1">&#39;syntax&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">a_call</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">ast_name</span> <span class="o">==</span> <span class="s1">&#39;Attribute&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a_call</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;open&#39;</span><span class="p">:</span>
                <span class="c1"># TODO: Make these feedback functions</span>
                <span class="n">explain</span><span class="p">(</span><span class="s2">&quot;You have attempted to call `open` as a &quot;</span>
                        <span class="s2">&quot;method, but it is actually a built-in function.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;used_open_as_method&quot;</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Open Is a Function&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">a_call</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span>
                <span class="n">closed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_call</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">called_open</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_filenames</span><span class="p">:</span>
        <span class="n">explain</span><span class="p">(</span><span class="s2">&quot;You have not opened all the files you were supposed to.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;unopened_files&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Unopened Files&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">called_open</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">num_filenames</span><span class="p">:</span>
        <span class="n">explain</span><span class="p">(</span><span class="s2">&quot;You have opened more files than you were supposed to.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;extra_open_files&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Extra Opened Files&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">withs</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;With&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">withs</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">closed</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_filenames</span><span class="p">:</span>
        <span class="n">explain</span><span class="p">(</span><span class="s2">&quot;You have not closed all the files you were supposed to.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;unclosed_files&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Unclosed Files&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">withs</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">closed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">num_filenames</span><span class="p">:</span>
        <span class="n">explain</span><span class="p">(</span><span class="s2">&quot;You have closed more files than you were supposed to.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;extra_closed_files&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Extra Closed Files&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">actual_filenames</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="n">ensured</span> <span class="o">=</span> <span class="n">ensure_literal</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ensured</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ensured</span>
    <span class="k">return</span> <span class="kc">False</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, acbart, lukesg08.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>